# HVAC控制动作音效系统

## 概述

为HVAC控制策略可视化demo添加了音效功能，每个控制动作发生时会播放悦耳的音乐化音调。系统使用浏览器内置的Web Audio API，无需任何外部音频库。

## 音效设计原理

### 音乐化设计
所有音效都基于C大调音阶设计，确保悦耳和谐：
- 使用标准音符频率（如A4=440Hz, C5=523Hz）
- 采用正弦波生成柔和音调
- 支持和弦效果（如制冷模式和制热模式）

### 动作分类音效

#### 1. ASHP（空气源热泵）- 9种动作
- **ASHP开启**: C5 (523Hz) - 明亮的开始音
- **ASHP关闭**: C4 (262Hz) - 低沉的结束音
- **ASHP设定温度上升**: E5 (659Hz) - 高音，传达上升感
- **ASHP设定温度下降**: A4 (440Hz) - 标准音高，传达下降感
- **ASHP风速上升**: G5 (784Hz) - 高能量音调
- **ASHP风速下降**: D4 (294Hz) - 低能量音调
- **ASHP制冷模式**: F4+A4 (349+440Hz) - 清凉和弦
- **ASHP制热模式**: E5+G5 (659+784Hz) - 温暖和弦
- **ASHP除湿模式**: B4 (494Hz) - 独特音调

#### 2. ERV（能量回收通风）- 4种动作
- **ERV开启**: G4 (392Hz)
- **ERV关闭**: D4 (294Hz)
- **ERV风速上升**: A4 (440Hz)
- **ERV风速下降**: F4 (349Hz)

#### 3. DEH（除湿机）- 2种动作
- **DEH开启**: E4 (330Hz)
- **DEH关闭**: C4 (262Hz)

### 音效时长与包络
- **瞬时动作**（开启/关闭）：0.15秒短促音效，快速淡入淡出
- **持续动作**（温度调节、风速调节、模式切换）：0.25-0.4秒音效，平滑淡入淡出

## 使用方法

### 启动应用
```bash
python app.py
```

访问: http://127.0.0.1:8050/

### 音效控制
1. **开启音效**（默认状态）：绿色按钮显示 🔊音效
2. **关闭音效**：点击后变为红色按钮显示 🔇静音
3. 可随时切换，无需刷新页面

### 体验音效
1. 点击 ▶️播放 按钮启动模拟
2. 观察右侧动作日志，每个动作发生时会播放对应音效
3. 不同的动作会有不同的音调和时长

### 音效示例
- **ASHP开启**: 清脆的C5高音（523Hz）- "叮"
- **ASHP制冷模式**: 双音和弦（F4+A4）- "噔噔"的清凉感
- **ASHP制热模式**: 高音和弦（E5+G5）- 温暖明亮的"当当"
- **温度调节**: 单音滑动效果，上升为高频，下降为低频
- **风速变化**: 短促的音调变化

### 注意事项
- 首次使用时浏览器可能会要求音频播放权限，请允许
- 音效在客户端生成，不会占用网络带宽
- 音量较小（峰值0.25-0.3），不会过于刺耳
- 如果听不到声音，请检查系统音量设置

## 技术实现

### Web Audio API
- 使用浏览器原生AudioContext
- 正弦波振荡器（Oscillator）生成纯音调
- 增益节点（GainNode）控制音量包络
- 支持多频率叠加（和弦效果）

### Dash集成
- **clientside callback**：在浏览器端直接播放音效，减少服务器负担
- **音频状态管理**：使用dcc.Store存储静音状态
- **动作检测**：自动检测新动作并触发音效

### 性能优化
- 音效在客户端生成，不占用网络带宽
- 重用AudioContext实例，避免重复创建
- 轻量级实现，不影响界面流畅度

## 音效特点

✅ **悦耳动听**：基于音乐理论的频率选择
✅ **区分明显**：不同设备和动作有独特音调
✅ **和谐统一**：所有音效都在C大调音阶内
✅ **动态平滑**：带淡入淡出效果，不刺耳
✅ **可控性强**：一键静音/开启
✅ **零依赖**：纯Web Audio API，无需外部库

## 扩展建议

如需进一步定制音效：
1. 修改 `app.py` 中的 `SOUND_MAPPING` 字典调整频率
2. 修改 `clientside_callback` 中的 `oscillator.type` 改变音色（sine/square/triangle/sawtooth）
3. 调整音量包络参数改变淡入淡出效果
4. 添加更多频率实现更丰富的和弦

---

**开发时间**: 2025-11-20
**使用技术**: Dash, Web Audio API, JavaScript
**音效设计**: 基于C大调音阶的音乐化音效系统
