# HVAC控制策略动态可视化 - 使用指南

## 快速开始

### 方法1：使用启动脚本（推荐）
1. 双击 `start.bat` 文件
2. 浏览器会自动打开 http://127.0.0.1:8050/
3. 开始使用！

### 方法2：命令行启动
```bash
cd D:\VFLab\VFLAB\visual-t-main\visual-t-main\xyk-ideas\hvac-control-demo
python app.py
```

## 界面说明

### 顶部状态面板（3个指标卡）
```
┌─────────────────┬─────────────────┬─────────────────┐
│   实行策略      │   当前状况      │   舒适度评分    │
│ 自适应控制      │   正常/预警/故障│   85.3 分       │
└─────────────────┴─────────────────┴─────────────────┘
```
- **实行策略**：显示当前控制策略名称
- **当前状况**：
  - 绿色="正常"
  - 橙色="预警"（舒适度<60）
  - 红色="故障"（设备异常）
- **舒适度评分**：0-100分（综合温湿度偏离度）

### 播放控制栏
```
[▶️ 播放] [⏸️ 暂停] [🔄 重置] | 播放速度: [1x ▼]  当前时间: 2025-11-20 14:23:15
```

**控制说明：**
- `▶️ 播放`：启动动态时序流动（每2秒更新一次）
- `⏸️ 暂停`：暂停数据更新，方便观察细节
- `🔄 重置`：清空历史数据，重新开始模拟
- `播放速度`：
  - 0.5x - 慢速播放（适合学习观察）
  - 1x - 正常速度
  - 2x - 2倍速
  - 5x - 5倍速（快速预览）

### 温湿度监控图（上图）

**图表要素：**
1. **实测曲线（粗实线）**
   - 红色 = 实测温度
   - 蓝绿色 = 实测湿度

2. **预测曲线（虚线）**
   - 提前5步（25分钟）
   - 颜色与实测对应，但透明度更低

3. **动作标注**
   - **深色竖线** = 瞬时动作（开启/关闭）
     - 出现时刻：设备启停的瞬间
   - **彩色覆盖区** = 持续动作
     - 蓝色区 = ASHP制冷模式
     - 橙色区 = ASHP制热模式
     - 青绿区 = ASHP除湿模式
     - 其他颜色 = 风速调节、温度设定调节

4. **时间窗口**
   - 显示最近90个时间步（约7.5小时）
   - 自动滑动，保持最新数据在右侧

### 能耗电费监控图（下图）

**图表要素：**
1. **总功率曲线（橙色填充区域）**
   - 显示ASHP + ERV + DEH的总功率消耗
   - 单位：kW

2. **累计电费曲线（紫色线）**
   - 从模拟开始累计的电费
   - 单位：元

3. **峰谷电价标识**
   - **粉色背景区** = 峰时电价（8:00-22:00，1.2元/kWh）
   - **白色背景区** = 谷时电价（22:00-8:00，0.4元/kWh）

## 典型使用场景

### 场景1：观察控制策略效果
1. 点击"播放"开始模拟
2. 观察温度波动时，ASHP如何响应：
   - 温度>24.5°C → 启动制冷
   - 温度<20.5°C → 启动制热
3. 注意预测曲线（虚线）的提前性

### 场景2：分析能耗优化
1. 观察峰谷电价时段切换
2. 对比不同时段的功率消耗
3. 查看累计电费增长曲线
4. 评估策略的经济性

### 场景3：故障诊断演示
1. 当"当前状况"显示红色"故障"时
2. 暂停播放，仔细观察：
   - 温湿度是否异常偏离
   - 舒适度评分是否骤降
   - 设备动作是否频繁
3. 分析故障原因

### 场景4：策略对比研究
1. 记录一次完整模拟的关键指标：
   - 总电费
   - 平均舒适度
   - 设备运行时间
2. 重置后再次模拟
3. 对比不同策略效果

## 数据解读技巧

### 温湿度趋势
- **稳定曲线** = 控制效果好
- **剧烈波动** = 控制不稳定或外部扰动大
- **虚线提前** = 预测性控制，提前感知趋势

### 功率曲线特征
- **阶跃上升** = 设备启动
- **阶跃下降** = 设备关闭
- **缓慢爬升** = 负荷增加（如温差增大）
- **高频波动** = 风速调节或模式切换频繁

### 动作序列密度
- **竖线密集** = 设备频繁启停（可能不节能）
- **覆盖区连续** = 设备持续运行（稳定控制）
- **多色叠加** = 多设备协同工作

### 舒适度评分
- **>80分** = 优秀，环境舒适
- **60-80分** = 良好，可接受
- **<60分** = 预警，需要调整策略
- **骤降** = 可能故障或突发扰动

## 常见问题

### Q1: 为什么预测曲线有时不准？
A: 这是简单的线性预测模型，仅用于演示。实际应用中会使用更复杂的机器学习模型。

### Q2: 可以调整模拟参数吗？
A: 可以！编辑 `hvac_simulator.py`，修改以下参数：
- `timestep_minutes`: 时间步长（默认5分钟）
- `peak_price` / `valley_price`: 峰谷电价
- 控制逻辑（`_generate_control_actions`方法）

### Q3: 如何保存模拟结果？
A: 运行 `test_demo.py` 会生成静态HTML图表保存在 `test_output/` 文件夹。

### Q4: 可以接入真实数据吗？
A: 可以！修改 `hvac_simulator.py` 中的数据生成方法，从传感器API或数据库读取真实数据。

## 技术参数

- **模拟时间步长**：5分钟
- **数据刷新频率**：2秒
- **显示窗口**：最近90个时间步（7.5小时）
- **预测提前量**：5步（25分钟）

## 扩展建议

1. **多策略对比模式**：同时运行2-3种策略，对比效果
2. **历史回放功能**：保存模拟数据，支持时间穿梭
3. **参数调优界面**：增加滑块控件，实时调整控制参数
4. **导出报告**：生成PDF性能分析报告
5. **接入RL模型**：集成强化学习控制器

## 技术支持

如有问题，请查看：
- 完整文档：`README.md`
- 代码注释：`hvac_simulator.py`、`app.py`
- 测试脚本：`test_demo.py`
