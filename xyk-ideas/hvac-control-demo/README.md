# HVAC控制策略动态可视化Demo

基于 `dynamic-ideas.md` 设计理念实现的空调控制策略动态时序可视化系统。

## 功能特点

### 📊 双Y轴动态图表
1. **温湿度监控图**
   - 实线：实测温度/湿度
   - 虚线：预测温度/湿度（提前5步）
   - 背景覆盖色：控制动作序列标注

2. **能耗电费监控图**
   - 总功率曲线（填充区域）
   - 累计电费曲线
   - 峰谷电价时段标识

### 🎮 播放控制
- ▶️ 播放：启动动态时序流动
- ⏸️ 暂停：暂停数据更新
- 🔄 重置：重新开始模拟
- 🔊 音效：切换动作音效开关（默认开启）
- 播放速度：0.5x / 1x / 2x / 5x

### 🎵 动作音效系统（新增）
- **音乐化设计**：基于C大调音阶，所有音效和谐悦耳
- **智能区分**：瞬时动作短音（0.15秒），持续动作长音（0.25-0.4秒）
- **和弦效果**：制冷/制热模式使用双音和弦
- **一键静音**：🔊/🔇 按钮实时切换
- **详细说明**：参见 [AUDIO_SYSTEM.md](AUDIO_SYSTEM.md)

### 🔧 三设备控制动作
**ASHP（空气源热泵）**
- 瞬时动作（竖线）：开启、关闭
- 持续动作（覆盖色）：设定温度上升/下降、风速上升/下降、制冷/制热/除湿模式

**ERV（能量回收通风）**
- 瞬时动作（竖线）：开启、关闭
- 持续动作（覆盖色）：风速上升/下降

**DEH（除湿机）**
- 瞬时动作（竖线）：开启、关闭

### 📈 状态分析面板
- 实行策略：当前控制策略名称
- 当前状况：正常/预警/故障（颜色标识）
- 舒适度评分：0-100分

## 技术实现

### 架构
- **数据模拟器**：`hvac_simulator.py` - 生成温湿度、能耗、电费和控制动作的时序数据
- **可视化应用**：`app.py` - Dash + Plotly 实现动态双Y轴图表
- **样式规范**：遵循 CLAUDE.md 可视化标准（颜色、字体、布局）

### 核心参数
- 数据刷新频率：2秒
- 时间窗口：最近90个时间步
- 时间步长：5分钟
- 预测提前量：5步（25分钟）

## 安装与运行

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 运行应用
```bash
python app.py
```

### 3. 访问界面
在浏览器中打开: http://127.0.0.1:8050/

## 文件结构
```
hvac-control-demo/
├── hvac_simulator.py    # HVAC系统模拟器
├── app.py               # Dash可视化应用（含音效系统）
├── requirements.txt     # Python依赖
├── README.md            # 本文档
├── AUDIO_SYSTEM.md      # 音效系统详细说明
└── start.bat            # Windows启动脚本
```

## 使用说明

1. **启动应用**后会自动初始化模拟数据（10个时间步）
2. 点击 **"▶️ 播放"** 开始动态时序流动
3. 观察温湿度、能耗变化以及控制动作的触发
4. **体验音效**：每个动作发生时会播放对应音调，点击 **"🔊 音效"** 切换静音
5. 调整 **播放速度** 加快或减慢流动效果
6. 点击 **"⏸️ 暂停"** 可以暂停查看细节
7. 点击 **"🔄 重置"** 重新开始模拟
8. 查看右侧 **动作日志** 了解控制序列详情

## 技术亮点

### 预测提前显示
- 预测曲线（虚线）始终提前实测曲线5步
- 体现预测性控制的前瞻性

### 动作序列可视化
- **瞬时动作**（开启/关闭）用深色竖线标识
- **持续动作**（模式切换、调节）用半透明覆盖色标识
- 支持多设备动作重合显示

### 动作音效系统 🎵
- **Web Audio API**：浏览器原生支持，零依赖
- **音乐化设计**：C大调音阶，15种动作15种音调
- **和弦效果**：制冷模式双音和弦（F4+A4），制热模式（E5+G5）
- **智能包络**：淡入淡出效果，不刺耳
- **客户端生成**：不占服务器资源和网络带宽

### 峰谷电价标注
- 粉色区域：峰时电价（8:00-22:00）
- 白色区域：谷时电价（22:00-8:00）

### 智能控制策略
- 温度过高 → 启动制冷
- 温度过低 → 启动制热
- 湿度过高 → 启动除湿
- 白天开启ERV通风，夜间关闭节能
- 根据负荷动态调整风速

## 扩展方向

- [ ] 添加历史数据回放功能
- [ ] 实现多策略对比模式
- [ ] 接入真实传感器数据
- [ ] 导出报告和分析结果
- [ ] 添加故障诊断专家系统

## 参考
- 设计理念：`dynamic-ideas.md`
- 样式规范：`VFLAB/CLAUDE.md`
- 技术栈：Dash 2.14+ / Plotly 5.17+ / Python 3.11+
